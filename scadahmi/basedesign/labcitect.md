[<- До підрозділу](README.md)

# Практичне заняття SCADA Citect: розроблення проекту SCADA/HMI

**Тривалість**: 4 акад. годин (2 пари).

**Мета:** ознайомлення з основними можливостями середовища розробки Citect, та опанування роботи зі змінними.  

**Завдання для виконання роботи**

**Цілі.** 

1. Навчитися створювати, видаляти, архівувати та відновлювати проект Citect. 
2. Навчитися налаштовувати підсистему збору та обробки даних реального часу SCADA Citect. 
3. Навчитися створювати, редагувати та налагоджувати базові елементи SCADA/HMI Citect.

**Лабораторна установка**

- Апаратне забезпечення: ПК. 

- Програмне забезпечення: UNITY PRO V>=7.0 або Control Expert,  Citect 2016 (або новіше)

**Примітки щодо відео: представлені в роботі відеоматеріали є студентською інтерпретацією лабораторної роботи, носять ознайомчий характер і можуть містити помилки!** 

## Порядок виконання роботи 

Дане практичне заняття потребує виконання попереднього [Знайомство з середовищем виконання SCADA/HMI на прикладі Citect](../basic/labcitect.md)

## 1. Запуск проекту для ПЛК та ознайомлення з завданням

- [ ] Виконайте пункти з розділів 2, 3 та 4, що наведені в [Описі завдання для виконання на лабораторних роботах з дисципліни людино-машинні інтерфейси для Citect](task.md) 
- [ ] Ознайомтеся з іншими розділами опису завдання. 

**Увага!** [Опис завдання для виконання на лабораторних роботах з дисципліни людино-машинні інтерфейси для Citect](task.md) є документом, за яким виконуються усі лабораторні роботи по Citect!

## 2. Створення проекту Citect 

- [ ] Запустіть середовище розробки Citect Studio (рис.2.1).

![img](media2/clip_image002.png)

  Рис.2.1. Запуск середовища розробки Citect Studio

- [ ] Проконтролюйте відкриття двох редакторів: "Citect Studio" (надалі  ***Провідник*** ) та "Графический редактор" (надалі  ***графічний редактор***). 

- [ ] У провіднику створіть новий проект (рис.2.2):
  - У назві проекту вкажіть своє прізвище в англійській транслітерації, напиклад `HMIPupena`. Зверніть увагу, що назва проекту не повинна містити кириличних літер, пробілів і починатися з літери. 
  - У описі проекту вкажіть прізвище та номер групи. 
  - Шлях розміщення залиште за замовченням. 
  - Для спрощення створення проекту виставте опцію "Создать проект на основе начального проекта". 
  - У налаштуваннях вибору початкового проекту вкажіть шаблон, що найбільше підходить до типу вашого монітору. Якщо проект виконується в лабораторії А532, виберіть шаблон "SxW_Style_1_HD768_titlebar". 
  - Натисніть кнопку "ОК" для закінчення створення проекту.  

![img](media2/clip_image004.png)

Рис.2.2 Створення нового проекту 

- [ ] Знайдіть створений проект в списку проектів провідника. Натисніть на "Выбрать как активный". 

![img](media2/2_3.png)

Рис.2.3 Вибір активного проекту для редагування 

<iframe width="560" height="315" src="https://www.youtube.com/embed/cfmWUYAG2rw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 3. Навігація по проекту 

Завдяки виставленій опції створення проекту на базі початкового автоматично будуть створені: кластер, сервери, пристрої вводу/виводу, основні сторінки, меню, роль Адміністратора, файл Cicode. 

- [ ] Перейдіть до розділу "Топология" (рис.2.4):
  - Подивіться на вкладці "Компьютеры", які серверні компоненти створені у Вашому проекті. Кожен сервер відповідає за свою функцію обробки. За збір даних відповідає IOServer1.   
  - Подивіться на вкладці "Устройства ввода/вывода", які пристрої I/O створені у Вашому проекті.  За замовченням пристрій `Internal` відповідає за внутрішні теги серверу (які не зв'язані з зовнішнім джерелом даних), а `Cicode` - для розрахункових тегів.  

![](media2/2_4.png)

Рис.2.4 Топологія новоствореного проекту 

- [ ] Перейдіть до розділу "Визуализация" (рис.2.5):
  - Подивіться на вкладці "Конфигурация меню", які меню створені у Вашому проекті. Реалізація меню розглядається у іншій лабораторній роботі. За замовченням меню надає базові можливості для навігації проекту в середовищі виконання.
  - Подивіться на вкладці "Страницы", які сторінки створилися в проекті. За замовченням на вкладці не відображаються приховані сорінки (починаються з "!"). 

![](media2/2_5.png)

Рис.2.5 Меню та сторінки новоствореного проекту 

- [ ] У графічному редакторі виставте опцію відображення прихованих (системних) сторінок (рис.2.6)  

![](media2/2_6.png)

Рис.2.6 Налаштування відображення прихованих сторінок 

- [ ] У провіднику відкрийте розділ "Безопасность" і знайдіть роль. Ролі використовуються в налаштуваннях користувачів, які будуть розглядатися в одній із лабораторних робіт.

Також за замовченням створюються деякі інші об'єкти, які будуть розглянуті у інших лабораторних роботах.    

- [ ] Перейдіть в розділ "Проекты->Включенные проекты". Подивіться які проекти включенні за замовченням
- [ ] У провіднику Windows відкрийте директорію, в якій знаходиться Ваш проект. Для цього можна перейти в розділ провідника Citect "Проекты"->"Главная" і натиснути  "Открыть в проводнике". Перегляньте в якій директорії знаходяться файли і які розширення мають.

<iframe width="560" height="315" src="https://www.youtube.com/embed/NULVmvsWO7E" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 4. Компілювання та запуск проекту 

- [ ] Скомпілюйте активний проект.

 ![](media2/2_7.png)

Рис.2.7 Компілювання активного проекту

- [ ] Компілювання повинно пройти успішно. Для перегляду помилок компілювання можна відкрити спеціально призначене для цього вікно ("Компилировать сообщения").

- [ ] Якщо проект скомпілювався, перейдіть до виконання наступного пункту, якщо ні – за допомогою викладача виправте помилки.

Перед тим, як запустити новий проект необхідно налаштувати середовище виконання. Для цього використовується майстер, який Ви запускали на минулій лабораторній роботі.   

- [ ] Запустіть майстра установки, налаштуйте систему для запуску вашого проекту, аналогічно, як це робилося в [Знайомство з середовищем виконання SCADA/HMI на прикладі Citect](../basic/labcitect.md)

![](media2/2_8.png)

Рис.2.8 Запуск майстра установки.

- [ ] Запустіть проект на виконання.

Навіть в новоствореному проекті є готові сторінки для перегляду.

- [ ] Перегляньте структуру меню, та відкрийте кілька сторінок для перевірки роботи меню.
- [ ] Завершіть роботу середовища виконання.

<iframe width="560" height="315" src="https://www.youtube.com/embed/yAg_-MUCWlo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 5. Конфігурування пристрою вводу/виводу 

- [ ] Детально ознайомтеся з розділом "7. Вимоги до системи SCADA/HMI. Вимоги до комунікаційного обміну" [Завдання](task.md). 

- [ ] Для налаштування комунікаційного зв’язку через пристрій вводу/виводу запустіть майстер 

![](media2/2_9.png)

Рис.2.9 Запуск майстра налаштування пристрою вводу/виводу

- [ ] На рис.2.10 для кожного пункту показано зовнішній вигляд вікон, налаштуйте наступні налаштування: 

(1) у стартовому вікні натисніть "Далее"; 

![img](media2/2_10.png)

 Рис.2.10. Вікна помічника налаштування комунікацій 

(2) у вікні створення серверу залиште "IOServer" – назва серверу вводу/виводу, який буде використовуватися для роботи з пристроями вводу/виводу; зверніть увагу, що **у Вашому проекті повинен      бути тільки один сервер вводу виводу**, оскільки він вже існує – просто виберіть його зі списку;  

(3) у вікні створення пристрою вводу/виводу введіть назву пристрою, наприклад "PLCM340"; зверніть увагу, що назва повинна містити тільки літери латинського алфавіту, починатися з літери, не містити пробілів і також інших службових символів (може містити "_");  

(4) у вікні вибору типу пристрою вкажіть "внешние устройства I/O", так як створені в його межах змінні Citect мають за джерело даних змінні зовнішнього пристрою вводу/виводу;

(5) у вікні вибору моделі пристрою та протоколу вкажіть у розділі "Schneider Electric" -> "М340" ->"Modbus/TCP (Ethernet)";

(6) у вікні налаштування параметрів TCP/IP вкажіть IP адресу М340, або комп’ютера на якому знаходиться імітатор Unity PRO; якщо імітатор Unity PRO виконується на тому самому ПК що і  виконавча система  Citect, тут необхідно вписати 127.0.0.1;

(7) вікно означення зовнішньої БД тегів дає можливість підключити або імпортувати зовнішній файл, в якому знаходиться база даних змінних тегів вводу/виводу, що у багатьох випадках скорочує час створення та налагодження проекту; механізми імпорту/експорту на даному етапі використовуватися не будуть, тому у цьому вікні нічого не вказуйте, просто натисніть "Далее";       

(8) у вікні завершення майстра передивіться перелік того, що він буде створювати і натисніть "Готово". 

Зверніть увагу, що **для зміни налаштувань існуючих пристроїв вводу/виводу майстер налаштування запускати не потрібно**, бо кожного разу у результаті запуску будуть створюватися нові записи в базі даних проекту!   

- [ ] Перевірте результати роботи майстра, переглянувши наступні розділи проекту через провідник(рис.2.11):

- Устройства ввода/вывда
- Модули
- Порты

- [ ] Подивіться скільки є записів у кожному розділі, які поля заповнені, як забезпечується ієрархія вкладеності `Модулі -> порти -> пристрої вводу/виводу`

![img](media2/2_11.png)

 Рис.2.11. Налаштування пристроїв

- [ ] Зверніть увагу, де налаштовуються параметри комунікацій IP та TCP порт, які були задані в майстрі. Це може здатися не логічним з точки зору ієрархії, тому для налаштування кожного окремого типу драйверу варто спочатку читати документацію.   

<iframe width="560" height="315" src="https://www.youtube.com/embed/8e0S1MM_O3Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 6. Створення перших тегів

У нових програмах Citect (починаючи з версії 2016), є табличні редактори, які можна налаштувати під свої потреби.

- [ ] Відкрийте редактор тегів (рис.2.12). Налаштуйте (виставте опціями), щоб в редакторі відображалися тільки ті колонки, які показані на рис.2.12.  

![img](media2/2_12.png)

 Рис.2.12. Налаштування табличного редактору тегів

- [ ] Створіть два змінних теги: один аналоговий (див. перший запис таблиці 1 [завдання](task.md)) та один дискретний (див. перший запис таблиці 2 файлу завдання). Рекомендується імена тегам давати такі самі як в проекті Unity PRO. На рис.2.13 показані поля записів для цих змінних. 

| Имя тега | Тип данных | Устройства | Адрес  | Комментарий                     | Абс.мин.знач | Абс.макс.знач | Мин.знач в ед.изм | Макс.знач в ед.изм | Ед. изм | Формат |
| -------- | ---------- | ---------- | ------ | ------------------------------- | ------------ | ------------- | ----------------- | ------------------ | ------- | ------ |
| T1_LT1   | INT        | PLCM340    | %MW100 | Рівень T1                       | 0            | 10000         | 0                 | 100                | %       | ##.#   |
| D1_LSH   | DIGITAL    | PLCM340    | %M0    | Сигналізатор верхнього рівня D1 |              |               |                   |                    |         |        |

![img](media2/2_13.png)

Рис.2.13. Створення змінних

- [ ] Натисніть "Сохранить"

- [ ] Скомпілюйте проект. Перевірте наявність помилок та попереджень, якщо таких не виявлено – перейдіть до наступного пункту, інакше – виправте помилки. 

<iframe width="560" height="315" src="https://www.youtube.com/embed/6zX22KzJma0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 7. Виведення перших тегів на мнемосхему

- [ ] Відкрийте сторінку Startup (рис.2.14)

![img](media2/2_14.png)

Рис.2.14. Відкриття сторінки Startup 

- [ ] Видаліть рисунок з демо ("Citect Scada ..."), що розміщений на мнемосхемі.
- [ ] Відкрийте вікно властивостей сторінки (контекстне меню сторінки ->"Свойства страницы..") змініть фон на сірий (Color80) як це показано на рис.2.15. Після цього натисніть "Ok"

![img](media2/2_15.png)

Рис.2.15 Зміна фону сторінки

- [ ] Видаліть лишні елементи, що залишились на мнемосхмі. Для виділення можна натиснути комбінацію "CTRL A" після чого копку "Delete"  
- [ ] Перейдіть в Citect Studio і змініть режим прив'язки за замовченням до тегів замість устатковання ("оборудование") (рис.2.16) 

![img](media2/2_16.png)

Рис.2.16 Налаштування прив'язки до тегів 

- [ ] Перейдіть в редактор графіки, розмістіть на сторінці 4 графічні елементи, як це зображено на рис.2.17, користуючись описаними нижче (під рисунком) процедурами, :

1. текстові написи "Рівень Т1" та "Сигналізатор верхнього рівня"
2. джини для відображення та зміни значень змінних `T1_LT1` та `D1_LSH`. 

![img](media2/2_17.png)

Рис.2.17. Зовнішній вигляд сторінки у режимі розробки

Текстові поля створюються з використанням елементу "Текст", що вибирається з палітри інструментів (рис.2.18) або з меню графічного редактору "Объекты" -> "Текст". Зверніть увагу, що **перед розміщенням на сторінці текстового елементу в ньому необхідно набрати текст**.

Для відображення та зміни значення числової змінної скористуйтесь джином "Parameter2" з бібліотеки "keyentry". Джин – це графічний бібліотечний елемент з вбудованою анімацією. Для прив’язки змінної до анімації, після вставки джина з'явиться вікно прив’язки, куди треба буде вказати змінну. Для відображення та зміни значення дискретної змінної, скористуйтесь джином "On_off_toogle2" з бібліотеки "keyentry". 

![img](media2/clip_image018.png)

Рис.2.18 Створення графічних елементів

- [ ] Після усіх дій збережіть сторінку у графічному редакторі через меню "Файл"->"Сохранить"   

З деталями налаштування основних графічних можливостей Citect Ви ознайометесь у наступних лабораторних роботах. 

<iframe width="560" height="315" src="https://www.youtube.com/embed/zNuUCUaY8Ic" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 8. Створення користувача

- [ ] У провіднику створіть користувача "admin" з правами адміністратора (рис.2.19). Задайте нескладний пароль, щоб Ви запам'ятали. 
- [ ] Збережіть зміни ("Сохранить")

![img](media2/2_19.png)

 Рис.2.19 Створення користувача

<iframe width="560" height="315" src="https://www.youtube.com/embed/h5t3sZIzzCY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 9. Запуск і перевірка роботи

- [ ] Скомпілюйте проект. Перевірте наявність помилок та попереджень, якщо таких не виявлено – перейдіть до наступного пункту, інакше – виправте помилки.
- [ ] Завантажте в імітатор ПЛК і запустіть на виконання проект Unity PRO, відповідно до того, як це описано в пункті 2 [завдання](task.md). 
- [ ] Запустіть на виконання скомпільований проект Citect.

**Увага!** Якщо користувач не зареєстрований, замість кириличного тексту може з'явитися нечитабельні шрифти. Це пов'язано з тим що за замовченням не виставлена правильна кодова сторінка. Щоб цього позбутися необхідно зареєструватися в системі з вибором криличної мови, у даному випадку Russian. Іншим способом є встановлення в Citect.ini кириличної кодової сторінки за замовченням, що буде розглядатися пізніше в даній лабораторній роботі.         

- [ ] Зареєструйте користувача "admin" в системі для можливості проведення усіх операцій (рис.2.20). 

![img](media2/2_20.png)

Рис.2.20 Реєстрація користувача в системі

- [ ] Перевірте чи відображаються значення змінних в середовищі виконання. Якщо замість них відображаються написи "BAD" чи "COM" – це значить, що є проблеми у зв’язку з контролером (або імітатором Unity PRO) і необхідно їх вирішувати за допомогою викладача. У іншому випадку – переходьте до наступного пункту.  

- [ ] Використовуючи операторські екрани в Unity PRO перейдіть в режим форсування змінної датчика рівня `T1_LT1` (`AIFRC[0]`) та сигналізатора `D1_LSH` (`DIFRC[12]`) на операторському екрану Screens. Деталі режимів форсування описані у файлі [Завдання](task.md) та перевірялися на початку лабораторної роботі. 
- [ ] У режимі форсування перевірте змініть значення в середовищі Citect для цих змінних. Перевірте чи відповідає це таким саме значенням в Unity PRO. Зверніть увагу на масштабування `T1_LT1`. Якщо усі зміни відбуваються коректно – переходьте до наступного пункту.
- [ ] Закрийте средовище виконання.

<iframe width="560" height="315" src="https://www.youtube.com/embed/Th9MwYDOnhY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## 10. Створення резервної копії

- [ ] Зробіть резервну копію проекту як це показано на рис.2.21. Розміщення файлу резервної копії зручно робити на робочому столі.
- [ ] Після процедури створення знайдіть файл резервної копії з розширенням ctz. 

Необхідно періодично робити резервні копії. Це дасть можливість у випадку непередбачуваних змін в проекті відновити стару версію. Також це є самим простим і безпечним механізмом перенесення проекту з одного комп’ютера на інший.    

 ![img](media2/2_21.png)

Рис.2.21 Створення резервної копії проекту

- [ ] Відновіть резервну копію проекту в новий проект з таким саме ім’ям але з суфіксом "Rest" (рис.2.22). Перед відновленням необхідно підтвердити пропозицію середовища Citect на створення нової папки проекту.    

Відновлення проекту можна робити і в існуючий проект, але тоді файли існуючого проекту будуть замінені файлами резервної копії. Необхідно дуже уважно ставитися до процедури створення та відновлення резервної копії проекту. 

![img](media2/2_22.png)

Рис.2.22 Відновлення резервної копії проекту

- [ ] Видаліть проект з суфіксом "Rest" (той який створився у результаті відновлювався в попередньому пункті).

**Увага! Кожного разу по завершенню заняття створюйте резервні копії та забирайте їх з собою, для збереження проекту!**

<iframe width="560" height="315" src="https://www.youtube.com/embed/OGUXa6D092c" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## Питання до захисту 

1. Поясніть відмінність понять середовища розробки та середовища виконання SCADA/HMI. Яке саме середовище потрібне для роботи АРМу оператору на підприємстві?
2. Поясніть що таке проект SCADA/HMI? Чим відрізняється вихідний проект від скомпільованого і коли     підприємству необхідні обидва варіанти проектів?
3. Від чого залежить вартість середовища виконання SCADA/HMI?
4. Які типові функції надають програми SCADA/HMI?
5. Що таке база даних реального часу? 
6. Поясніть, що таке тег SCADA? Що може бути джерелом даних для тега?
7. Поясніть що таке відмітка часу і показник достовірності тегу?
8. Розкажіть про призначення основних редакторів  Citect.
9. Чому у включених проекту з'явився файл "Sxw_Style_Include"? Чи міг там з'явитися інший проект? На що це впливає? 
10. Що собою представляє проект Citect з точки зору файлової системи Windows?
11. Як середовище розробки Citect дізнається де знаходяться проекти на комп'ютері? 
12. Як середовище виконання Citect дізнається де знаходяться файли режиму виконання на комп'ютері? 
13. Як можна дізнатися про розміщення папки проекту середовища розробки?
14. Для чого потрібен Citect Studio? Розкажіть про можливості які Ви використовували в цій лабораторній роботі. 
15. Поясніть для чого потрібна компіляція проекту. Які ситуації можливі при компіляції проекту? Як дізнатися про помилки компіляції?
16. Яке призначення майстра налаштування комунікацій? Які зміни в проект вносить майстер? Чи можна створити ці записи в проекті самостійно? Обґрунтуйте необхідність використання цього майстра.
17. Що і де необхідно змінити в існуючому проекті, щоб вказати іншу IP адресу ПЛК?  
18. Навіщо потрібно створювати резервну копію проекту? Розкажіть основні процедури створення та відновлення резервної копії проекту.

Практичне заняття розробив [Олександр Пупена](https://github.com/pupenasan) 
